---
title: "åŒºåŸŸé”€å”®ä¸šç»©æœˆåº¦æŠ¥å‘Š"
author: "é”€å”®è¿è¥éƒ¨"
date: "`r Sys.Date()`"
output:
  html_document:
    theme: flatly
    toc: true
params:
  region: "North America"
  min_sales: 1000
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(ggplot2)
library(dplyr)
library(knitr)
```

# ğŸ“‹ æŠ¥å‘Šæ¦‚è§ˆ

> **å…¸å‹ç”¨é€”ï¼šå‚æ•°åŒ–æŠ¥å‘Š (Parameterized Reporting)**
> 
> R Markdown çš„æ€æ‰‹çº§åŠŸèƒ½ã€‚è¿™ä»½æŠ¥å‘Šå¯ä»¥æ ¹æ® `params` ä¸­çš„ `region` å‚æ•°è‡ªåŠ¨ç”Ÿæˆä¸åŒç‰ˆæœ¬ã€‚
> åœ¨ Posit Connect ä¸Šï¼Œä½ å¯ä»¥è®¾ç½®è®¡åˆ’ä»»åŠ¡ï¼Œæ¯å‘¨ä¸€è‡ªåŠ¨ç”Ÿæˆå¹¶å‘é€ "åŒ—ç¾åŒº"ã€"äºšå¤ªåŒº" ç­‰ä¸åŒç‰ˆæœ¬çš„æŠ¥å‘Šç»™å¯¹åº”çš„è´Ÿè´£äººã€‚

**å½“å‰æŠ¥å‘ŠåŒºåŸŸ**: `r params$region`  
**é”€å”®é¢é˜ˆå€¼**: `r params$min_sales`

---

```{r data-generation}
# æ¨¡æ‹Ÿæ•°æ®
set.seed(123)
regions <- c("North America", "Europe", "Asia Pacific", "Latin America")
products <- c("Laptop", "Phone", "Tablet", "Accessories")

data <- data.frame(
  Date = seq(as.Date("2024-01-01"), as.Date("2024-12-31"), by="day"),
  Region = sample(regions, 366, replace = TRUE),
  Product = sample(products, 366, replace = TRUE),
  Sales = round(rnorm(366, mean = 2000, sd = 500), 2)
)

# æ ¹æ®å‚æ•°è¿‡æ»¤æ•°æ®
filtered_data <- data %>%
  filter(Region == params$region, Sales >= params$min_sales)
```

## 1. å…³é”®æŒ‡æ ‡ (KPIs)

```{r kpi}
total_sales <- sum(filtered_data$Sales)
avg_sales <- mean(filtered_data$Sales)
top_product <- names(which.max(table(filtered_data$Product)))

kpi_df <- data.frame(
  æŒ‡æ ‡ = c("æ€»é”€å”®é¢", "å¹³å‡å®¢å•ä»·", "æœ€ç•…é”€äº§å“"),
  æ•°å€¼ = c(paste0("$", format(total_sales, big.mark=",")), 
         paste0("$", format(round(avg_sales, 2), big.mark=",")), 
         top_product)
)

kable(kpi_df, caption = "æœ¬æœˆæ ¸å¿ƒä¸šç»©æŒ‡æ ‡")
```

## 2. é”€å”®è¶‹åŠ¿åˆ†æ

```{r trend-plot, fig.width=10}
ggplot(filtered_data, aes(x = Date, y = Sales)) +
  geom_line(color = "#2c3e50", alpha = 0.3) +
  geom_smooth(method = "loess", color = "#00D9FF", fill = "#00D9FF", alpha = 0.2) +
  geom_point(aes(color = Product), size = 2) +
  theme_minimal() +
  labs(title = paste(params$region, "é”€å”®è¶‹åŠ¿å›¾"),
       subtitle = "åŒ…å«è¶‹åŠ¿çº¿æ‹Ÿåˆ",
       y = "é”€å”®é¢ ($)") +
  theme(legend.position = "bottom")
```

## 3. äº§å“è¡¨ç°

```{r product-bar}
product_summary <- filtered_data %>%
  group_by(Product) %>%
  summarise(Total = sum(Sales)) %>%
  arrange(desc(Total))

ggplot(product_summary, aes(x = reorder(Product, Total), y = Total, fill = Product)) +
  geom_col() +
  coord_flip() +
  theme_minimal() +
  labs(title = "å„äº§å“çº¿æ€»é”€å”®é¢", x = "", y = "æ€»é”€å”®é¢") +
  theme(legend.position = "none")
```

## 4. è¯¦ç»†æ•°æ® (Top 10)

```{r data-table}
filtered_data %>%
  arrange(desc(Sales)) %>%
  head(10) %>%
  kable(caption = "é”€å”®é¢æœ€é«˜çš„ 10 ç¬”è®¢å•")
```
